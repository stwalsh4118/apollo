# [16-3] Integrate Sanitizer into Orchestrator Pipeline

[Back to task list](./tasks.md)

## Description

Wire the `SanitizeDir` call into the orchestrator's `RunJob` method so it runs after pass 4 completes and before `AssembleFromDir`. This is the integration point described in the PRD: the orchestrator calls `SanitizeDir(workDir)` to modify files in place, then proceeds to assembly. If the sanitizer returns an error (missing required fields), the job should fail with a descriptive error message.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-20 13:13:28 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. In `api/internal/research/orchestrator.go`, add a `SanitizeDir(workDir)` call in `RunJob()` between the pass 4 completion and the `AssembleFromDir(workDir)` call.
2. If `SanitizeDir` returns an error, fail the job with status "failed" and include the sanitizer error in the job error message.
3. Log sanitizer start/completion via zerolog (consistent with existing orchestrator logging patterns).
4. Do NOT change the sanitizer implementation (16-2) or the assembler.

## Implementation Plan

1. Read `orchestrator.go` around line 206 where `AssembleFromDir` is called.
2. Insert `SanitizeDir(workDir)` call before `AssembleFromDir`.
3. Add error handling: if sanitizer fails, update job status to "failed" with error message, return.
4. Add log lines: `"sanitizing research output"` before, `"sanitization complete"` after.

## Test Plan

- **Compilation**: `go build ./api/...` succeeds.
- **Existing tests**: `make check` passes (no regressions).
- **Code review**: Verify the call is in the correct position in the pipeline (after pass 4, before assembly).

## Verification

_To be filled during implementation._

## Files Modified

_To be filled during implementation._
