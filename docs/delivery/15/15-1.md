# [15-1] Per-File Output Types & Directory Constants

[Back to task list](./tasks.md)

## Description

Define Go structs for the intermediate file formats produced by the research pipeline's file-per-lesson output. These types represent the per-file JSON written by agents during passes 1-3 and read by the assembler (15-2). Also define constants for directory naming conventions and file patterns.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-20 08:42:07 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-20 08:46:34 | Status Change | Proposed | Agreed | Task approved | AI_Agent |
| 2026-02-20 08:46:34 | Status Change | Agreed | InProgress | Started implementation | AI_Agent |
| 2026-02-20 08:51:47 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-20 11:22:23 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. **TopicFile struct** — Represents `topic.json` written by Pass 1:
   - Topic-level metadata: `ID`, `Title`, `Description`, `Difficulty`, `EstimatedHours`, `Tags`, `SourceURLs`, `GeneratedAt`, `Version`
   - `Prerequisites` (reuse existing `PrerequisitesOutput` type)
   - `RelatedTopics []string`
   - `ModulePlan []ModulePlanEntry` — array of `{ID, Title, Description, Order}` stubs (no lessons)

2. **ModulePlanEntry struct** — Lightweight stub used in topic.json module plan:
   - `ID string`, `Title string`, `Description string`, `Order int`

3. **ModuleFile struct** — Represents `module.json` written/updated during Passes 2-3:
   - `ID`, `Title`, `Description`, `Order`
   - `LearningObjectives []string` (added in Pass 2)
   - `EstimatedMinutes int`
   - `Assessment json.RawMessage` (added in Pass 3)

4. **Lesson files** — Individual lesson JSON files reuse the existing `LessonOutput` struct from `curriculum.go`. No new type needed.

5. **Directory constants** in a new file or added to existing config:
   - `ModulesDirName = "modules"` — name of the modules subdirectory
   - `ModuleFileBaseName = "module.json"` — name of module metadata file
   - `TopicFileName = "topic.json"` — name of topic metadata file
   - Module directory pattern: `NN-<slug>` (e.g., `01-introduction`)
   - Lesson file pattern: `NN-<slug>.json` (e.g., `01-what-is-go.json`)

6. **JSON serialization** — All structs must serialize to JSON matching the conventions agents will write (camelCase or snake_case matching existing `CurriculumOutput` conventions).

## Implementation Plan

1. Create `api/internal/research/filetypes.go` with `TopicFile`, `ModulePlanEntry`, and `ModuleFile` structs
2. Add directory/file name constants to the same file or `api/internal/research/constants.go`
3. Ensure JSON tags match the naming convention used in existing `CurriculumOutput` (snake_case)
4. Add doc comments explaining the relationship between file types and pipeline passes

## Test Plan

- **Compilation**: All new types compile without errors
- **JSON round-trip**: Write a table-driven test that marshals each struct to JSON and unmarshals back, verifying field preservation
- **Tag verification**: Test that JSON output uses expected field names (snake_case)

## Verification

- All 5 tests pass: JSON round-trip for TopicFile, ModulePlanEntry, ModuleFile; field name verification for TopicFile and ModuleFile
- `make check` passes (fmt, vet, tests)
- Internal AI review: pass (0 critical, 0 high, 0 medium, 5 low)
- Low findings: constant renamed to match spec (ModuleFileBaseName); others informational

## Files Modified

- `api/internal/research/filetypes.go` — NEW: TopicFile, ModulePlanEntry, ModuleFile structs + directory constants
- `api/internal/research/filetypes_test.go` — NEW: JSON round-trip and field name tests
