# [4-9] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end tests verifying all PBI 4 Conditions of Satisfaction are met. Tests exercise the full stack from API to UI.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 05:11:17 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:40:24 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:46:17 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:23:56 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

Verify all 9 acceptance criteria from the PBI:

1. `PUT /api/progress/lessons/:id` stores status (`not_started`, `in_progress`, `completed`) and notes
2. `GET /api/progress/topics/:id` returns per-lesson status for all lessons in a topic
3. `GET /api/progress/summary` returns completion percentage and active topic count
4. "Mark Complete" button in lesson view updates status and shows visual confirmation
5. Module sidebar shows completion indicators (checkmark/filled circle per lesson)
6. Progress bar per module shows correct ratio of completed lessons
7. Personal notes persist across page reloads
8. Concept chips render for each concept taught/referenced in the current lesson
9. Clicking a concept chip navigates to the concept detail route

## Implementation Plan

1. Write Playwright E2E tests covering all 9 acceptance criteria
2. Seed test data (topic with modules, lessons, and concepts) via API
3. Test API endpoints directly for criteria 1-3
4. Test UI interactions for criteria 4-9 using browser automation
5. Follow existing E2E test patterns from PBI 3 tests

## Test Plan

### Objectives
Validate the complete learning progress and notes feature end-to-end.

### Test Scope
- API: Progress CRUD operations (status updates, notes persistence, summary aggregation)
- UI: Mark Complete flow, sidebar indicators, progress bars, notes, concept chips

### Environment & Setup
- Go API server running on test port
- Vite dev server with API proxy
- Playwright browser automation
- Seeded test data via API POST endpoints

### Key Scenarios

1. **Progress API CRUD**:
   - PUT lesson progress with status and notes → verify stored correctly
   - GET topic progress → verify all lesson statuses returned
   - GET summary → verify completion % and active topic count
   - PUT to non-existent lesson → verify 404

2. **Mark Complete flow**:
   - Navigate to lesson → click Mark Complete → verify button changes to Completed
   - Reload page → verify Completed state persists
   - Verify sidebar checkmark appears for completed lesson

3. **Progress bars**:
   - Complete 1 of N lessons → verify progress bar shows correct ratio
   - Complete all lessons → verify 100% bar

4. **Personal notes**:
   - Type notes → click Save → reload page → verify notes persisted
   - Update notes → save → verify updated content

5. **Concept chips**:
   - Navigate to lesson with concepts → verify chips render with correct names
   - Click concept chip → verify navigation to `/concepts/:id`
   - Navigate to lesson without concepts → verify no chips section

### Success Criteria
- All 9 acceptance criteria pass
- No regressions in existing PBI 3 functionality

## Verification

- TypeScript compilation: passes (`npx tsc --noEmit`)
- ESLint: passes (`pnpm exec eslint e2e/pbi4.spec.ts`)
- Go checks: all pass (`cd api && make check`)
- AI review: passed after fixing 1 critical (wrong CSS class selector), 2 medium (response checks in beforeAll, in_progress indicator coverage)

## Files Modified

- `web/e2e/pbi4.spec.ts` (new) — 13 Playwright E2E tests covering all 9 acceptance criteria
