# [4-4] Frontend progress API client and hooks

[Back to task list](./tasks.md)

## Description

Add fetch functions for the progress API to the frontend client, plus TanStack Query hooks for reading progress and a mutation hook for updating lesson progress.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 05:11:17 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:25:13 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:28:26 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:23:56 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Client functions in `web/src/api/client.ts`:
   - `fetchTopicProgress(topicId: string): Promise<TopicProgress>` → `GET /api/progress/topics/:id`
   - `fetchProgressSummary(): Promise<ProgressSummary>` → `GET /api/progress/summary`
   - `updateLessonProgress(lessonId: string, input: UpdateProgressInput): Promise<LessonProgress>` → `PUT /api/progress/lessons/:id` (uses `fetchJson` with method/body)

2. Query key factory in `web/src/api/hooks.ts`:
   - `progressKeys.topic(id)` → `["progress", "topic", id]`
   - `progressKeys.summary` → `["progress", "summary"]`

3. Query hooks in `web/src/api/hooks.ts`:
   - `useTopicProgress(topicId)` — fetches and caches topic progress
   - `useProgressSummary()` — fetches and caches summary

4. Mutation hook in `web/src/api/hooks.ts`:
   - `useUpdateLessonProgress()` — calls `updateLessonProgress`, invalidates both `progressKeys.topic(...)` and `progressKeys.summary` on success

5. Update `fetchJson` to support POST/PUT (add optional `options` parameter for method + body) or create a separate `mutateJson` helper

6. Re-export new hooks and types from `web/src/api/index.ts`

## Implementation Plan

1. Extend `fetchJson` or add `mutateJson` in `client.ts` to support PUT with JSON body
2. Add progress client functions to `client.ts`
3. Add query key factory, query hooks, and mutation hook to `hooks.ts`
4. Update `index.ts` exports

## Test Plan

- TypeScript compilation passes without errors
- Hooks use correct query keys for cache invalidation
- Mutation hook properly invalidates topic progress and summary queries

## Verification

_To be completed during implementation._

## Files Modified

- `web/src/api/client.ts`
- `web/src/api/hooks.ts`
- `web/src/api/index.ts`
