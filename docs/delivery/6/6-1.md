# [6-1] Research Job Models & Constants

[Back to task list](./tasks.md)

## Description

Define all Go types, constants, and configuration needed for the research agent pipeline. This includes research job domain types, CLI response parsing types, progress tracking structures, and configuration constants referenced by the PRD (section 6.3, 9.1).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 08:15:29 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. **Research Job Types** (`api/internal/models/research.go`):
   - `ResearchJob` struct matching the `research_jobs` table schema: `ID`, `RootTopic`, `CurrentTopic`, `Status`, `Progress` (JSON), `Error`, `StartedAt`, `CompletedAt`
   - `ResearchJobStatus` string type with constants: `StatusQueued`, `StatusResearching`, `StatusResolving`, `StatusPublished`, `StatusFailed`, `StatusCancelled`
   - `ResearchProgress` struct for the progress JSON field: `CurrentPass` (1-4), `TotalPasses` (4), `ModulesPlanned`, `ModulesCompleted`, `ConceptsFound`, `PassDescriptions` (map of pass number to description)
   - `CreateResearchJobInput` struct: `Topic` (required), `Brief` (optional) — matches `POST /api/research` body
   - `ResearchJobSummary` for list responses (subset of fields)

2. **CLI Response Types** (`api/internal/models/cli.go`):
   - `CLIResponse` struct: `Type`, `SessionID`, `Result` (for non-structured responses), `StructuredOutput` (`json.RawMessage`), `IsError` bool, `ErrorMessage` string
   - These match the JSON structure returned by `claude -p --output-format json`

3. **Configuration Constants** (`api/internal/config/research.go`):
   - `DefaultMaxResearchDepth` = 3
   - `DefaultMaxParallelAgents` = 3
   - `DefaultResearchWorkDir` = `./data/research`
   - `DefaultResearchModel` = `opus`
   - `ResearchPassCount` = 4
   - `ResearchSystemPromptFile` path to `skills/research.md`
   - Pass description constants for progress reporting

4. **No external packages required** — only stdlib and existing project types.

## Implementation Plan

1. Create `api/internal/models/research.go` with research job domain types.
2. Create `api/internal/models/cli.go` with CLI response parsing types.
3. Add research configuration constants to `api/internal/config/research.go`.
4. Ensure all JSON tags match the database column names and API response format.

## Test Plan

- **Compilation**: All new types compile without errors.
- **JSON serialization**: Unit test that `ResearchJob` and `ResearchProgress` marshal/unmarshal correctly, especially the progress JSON field.
- **Constants**: Verify status constants match the CHECK constraint values in the migration (`queued`, `researching`, `resolving`, `published`, `failed`, `cancelled`).

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
